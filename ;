#include "ViewportCamera.h"

void ViewportCamera::SetViewportSize(int w, int h){
    ViewWidth = w;
    ViewHeight = h;
};

glm::mat4 ViewportCamera::GetView() const{
    glm::mat4 view(1.0f);

    // rotate pitch around X, then yaw around Y
    view = glm::rotate(view, glm::radians(-Rotation.x), glm::vec3(1,0,0)); // pitch
    view = glm::rotate(view, glm::radians(-Rotation.y), glm::vec3(0,1,0)); // yaw

    view = glm::translate(view, -Position); // move camera into position
    return view;
}
glm::mat4 ViewportCamera::GetProjection() const{
    return glm::perspective(glm::radians(FOV),
                            (float)ViewWidth / (float)ViewHeight,
                            Near,
                            Far);
}

void ViewportCamera::ProcessMouseMotion(int dx, int dy){
    
    Rotation.y -= dx * MouseSpeed; 
    Rotation.x -= dy * MouseSpeed; 

    if (Rotation.x > 89.0f) Rotation.x = 89.0f;
    if (Rotation.x < -89.0f) Rotation.x = -89.0f;
}

void ViewportCamera::ProcessKeyboard(const Uint8* keystate, float deltatime){
    glm::vec3 front;
    front.x = cos(glm::radians(Rotation.y)) * cos(glm::radians(Rotation.x));
    front.y = sin(glm::radians(Rotation.x));
    front.z = sin(glm::radians(Rotation.y)) * cos(glm::radians(Rotation.x));
    front = glm::normalize(front);

    glm::vec3 right = glm::normalize(glm::cross(front, glm::vec3(0,1,0)));

    float speed = MoveSpeed * deltatime;

    if (keystate[SDL_SCANCODE_W]) Position -= front * speed;
    if (keystate[SDL_SCANCODE_S]) Position += front * speed;
    if (keystate[SDL_SCANCODE_A]) Position -= right * speed;
    if (keystate[SDL_SCANCODE_D]) Position += right * speed;
};
void ViewportCamera::UpdateCameraVectors() {
  
    glm::vec3 front;
    front.x = cos(glm::radians(Yaw)) * cos(glm::radians(Pitch));
    front.y = sin(glm::radians(Pitch));
    front.z = sin(glm::radians(Yaw)) * cos(glm::radians(Pitch));
    Front = glm::normalize(front);

    // Recalculate right and up
    glm::vec3 right = glm::normalize(glm::cross(Front, glm::vec3(0.0f, 1.0f, 0.0f)));
    Up = glm::normalize(glm::cross(right, Front));
};
